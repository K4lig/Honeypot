
# Cloud-Based Threat Intelligence System: SSH Honeypot & SIEM Analysis

![Project Banner](https://img.shields.io/badge/Status-Completed-success) ![Tech](https://img.shields.io/badge/Tech-Wazuh%20%7C%20Docker%20%7C%20Cowrie%20%7C%20GCP-blue)

## üö® Problem
In modern cloud environments, public-facing services like SSH are under constant attack by automated botnets and malicious actors. Organizations often lack visibility into **who** is attacking them, **how** they are bypassing authentication, and **what commands** they execute once inside. Without this intelligence, it is difficult to proactively harden defenses against real-world TTPs (Tactics, Techniques, and Procedures).

## üõ†Ô∏è Solution
I designed and deployed a scalable threat detection architecture using **Infrastructure as Code (Docker)** and cloud services. The system decoys attackers into a controlled environment and centralizes telemetry for analysis.

### Architecture
* **Cloud Provider:** Google Cloud Platform (GCP) Compute Engine.
* **Honeypot Node:** Ubuntu Server running **Cowrie** (a medium-interaction SSH/Telnet honeypot) to emulate a vulnerable Linux shell.
* **SIEM Node:** **Wazuh (v4.9)** deployed via **Docker Compose** for log aggregation, correlation, and alerting.
* **Integration:** Custom Wazuh Agent configuration to ingest unstructured JSON logs from Cowrie.
* **Detection:** Developed custom XML decoding rules to map Cowrie events (logins, commands, downloads) to security alerts.

**Technologies Used:** `Wazuh`, `Docker`, `Cowrie`, `Python`, `Bash`, `Google Cloud Platform`, `Linux (Ubuntu)`.

## üìà Outcome
The project resulted in a fully functional Threat Intelligence pipeline capable of:

1.  **Real-Time Detection:** Successfully detected and alerted on brute-force attempts and successful unauthorized logins within milliseconds.
2.  **Attacker Profiling:** Captured attacker shell interaction, including specific commands entered (`whoami`, `curl`, `wget`) and malware download attempts.
3.  **Visualization:** Built a dashboard visualizing the geolocation of attackers, most used credentials, and attack frequency over time.

This project demonstrates practical skills in **Cloud Security**, **Log Analysis**, **Detection Engineering**, and **Containerization**.

---

## üì∏ Screenshots & Demos

### 1. The SIEM Dashboard (Wazuh)
*Overview of security events generated by the Honeypot.*
![Wazuh Dashboard Screenshot](https://github.com/K4lig/Honeypot/tree/main/Assets/Overview.png)

### 2. Live Attack Detection
*Wazuh alert capturing a "Successful Login" event from an external attacker.*
![Attack Alert Screenshot]([INSERT_LINK_TO_YOUR_ALERT_IMAGE_HERE])

### 3. Captured Commands
*Log details showing the specific commands the attacker tried to execute.*
![Commands Screenshot]([INSERT_LINK_TO_YOUR_COMMANDS_IMAGE_HERE])

---
# üöÄ How to Replicate
## Deployment Guide: Cyber Intelligence Infrastructure (Honeypot + SIEM)

This guide details the step-by-step construction of a threat detection environment in the cloud using Google Cloud Platform (GCP).

**Architecture:**
1.  **SIEM Node:** Wazuh (v4.9) deployed via Docker.
2.  **Honeypot Node:** Cowrie (SSH/Telnet Honeypot) on Ubuntu Server.

---

## üß± PHASE 1: Infrastructure Preparation (GCP)

### 1.1 Configure Firewall (VPC Network)
Before creating the VMs, open the necessary ports.
* **Navigate to:** VPC network > Firewall > Create firewall rule.
* **Name:** `allow-security-lab`
* **Targets:** `All instances in the network`
* **Source IPv4 ranges:** `0.0.0.0/0`
* **Protocols and ports:**
    * `tcp:2222` (For attackers to access the Honeypot).
    * `tcp:443` (To access the Wazuh Dashboard).
    * `tcp:1514-1515` (Internal Agent-Server communication).

### 1.2 Create Virtual Machine 1 (SIEM Server)
* **Name:** `server-siem-wazuh`
* **Zone:** `us-central1-a`
* **Machine type:** `e2-custom` (2 vCPU, **6 GB RAM**). *Critical for Docker performance*.
* **Boot disk:** Ubuntu 22.04 LTS - **Size: 20 GB**.
* **Firewall:** Check "Allow HTTP/HTTPS traffic".

### 1.3 Create Virtual Machine 2 (Honeypot)
* **Name:** `server-honeypot-cowrie`
* **Zone:** `us-central1-a`
* **Machine type:** `e2-micro` (Cost-effective).
* **Boot disk:** Ubuntu 22.04 LTS - Size: 10 GB.
* **Network tags:** Type `honeypot`.

---

## üß† PHASE 2: SIEM Deployment (Wazuh with Docker)

SSH into `server-siem-wazuh`.

### 2.1 Install Docker Engine
```bash
# Update system
sudo apt-get update && sudo apt-get upgrade -y

# Official installation script
curl -fsSL [https://get.docker.com](https://get.docker.com) -o get-docker.sh
sudo sh get-docker.sh

# Grant permissions to the current user
sudo usermod -aG docker $USER
newgrp docker
```

### 2.2 Deploy Wazuh (Single Node)
```bash
# Clone official repository (Version 4.9.0)
git clone [https://github.com/wazuh/wazuh-docker.git](https://github.com/wazuh/wazuh-docker.git) -b v4.9.0
cd wazuh-docker/single-node

# Generate security certificates
docker compose -f generate-indexer-certs.yml run --rm generator

# Start containers
docker compose up -d
```

### 2.3 Dashboard Access
* **URL:** `https://<SIEM_PUBLIC_IP>`
* **User:** `Admin`
* **Password:** `SecretPassword`

## üçØ PHASE 3: Honeypot Deployment (Cowrie)
SSH into `server-honeypot-cowrie.`

### 3.1 Install Dependencies and Create User
```bash
sudo apt-get update
sudo apt-get install -y git python3-venv python3-pip libssl-dev libffi-dev build-essential python3-dev
sudo adduser --disabled-password cowrie
# (Press Enter to accept default values)
```

### 3.2 Install Cowrie (Virtual Environment)
```bash
# Switch to cowrie user
sudo su - cowrie

# Download code
git clone [http://github.com/cowrie/cowrie](http://github.com/cowrie/cowrie)
cd cowrie

# Create virtual environment
python3 -m venv cowrie-env
source cowrie-env/bin/activate

# Install dependencies
pip install --upgrade pip setuptools wheel
pip install --upgrade -r requirements.txt

# Install Cowrie in editable mode (Fixes path errors)
pip install -e .
```

### 3.3 Configure Trap Port (2222)
```bash
cd etc
cp cowrie.cfg.dist cowrie.cfg
nano cowrie.cfg
```
* **Find the line:** `listen_endpoints = tcp:22:interface=0.0.0.0`
* **Change to:** `listen_endpoints = tcp:2222:interface=0.0.0.0`
* Save `(Ctrl+O)` and Exit `(Ctrl+X)`.

### 3.4 Start the Honeypot
```bash
# Ensure you are in ~/cowrie/cowrie
bin/cowrie start
```

## üîó PHASE 4: Agent -> SIEM Connection
On the machine `server-honeypot-cowrie` (exit the `cowrie` user by typing `exit`).

### 4.1 Install Wazuh Agent
```bash
# Import GPG key
curl -s [https://packages.wazuh.com/key/GPG-KEY-WAZUH](https://packages.wazuh.com/key/GPG-KEY-WAZUH) | sudo gpg --no-default-keyring --keyring gnupg-ring:/usr/share/keyrings/wazuh.gpg --import && sudo chmod 644 /usr/share/keyrings/wazuh.gpg

# Add repository
echo "deb [signed-by=/usr/share/keyrings/wazuh.gpg] [https://packages.wazuh.com/4.x/apt/](https://packages.wazuh.com/4.x/apt/) stable main" | sudo tee -a /etc/apt/sources.list.d/wazuh.list

# Update and Install
sudo apt-get update
# REPLACE <DOCKER_INTERNAL_IP> WITH THE PRIVATE IP OF THE SIEM SERVER
sudo WAZUH_MANAGER='<DOCKER_INTERNAL_IP>' apt-get install wazuh-agent -y
```

### 4.2 Configure Log Reading and Permissions
The agent needs permission to read the JSON file generated by Cowrie.
```bash
# Grant wazuh group permissions to read cowrie logs
sudo usermod -a -G cowrie wazuh
sudo chmod 750 /home/cowrie/cowrie/var/log/cowrie
sudo chmod 640 /home/cowrie/cowrie/var/log/cowrie/cowrie.json

# Edit agent configuration
sudo nano /var/ossec/etc/ossec.conf
```

Add the following block before the `</ossec_config>` tag:
```xml
<localfile>
  <log_format>json</log_format>
  <location>/home/cowrie/cowrie/var/log/cowrie/cowrie.json</location>
</localfile>
```

### 4.3 Start Agent
```bash
sudo systemctl daemon-reload
sudo systemctl enable wazuh-agent
sudo systemctl start wazuh-agent
```

## üõ°Ô∏è PHASE 5: Detection Engineering (Rules)
To visualize alerts, we must teach Wazuh how to interpret Cowrie logs.

1. Access the Wazuh Dashboard via web.
2. Navigate to: Management > Rules > Manage rules files.
3. Edit the file local_rules.xml.
4. Paste the following content:
```xml
<group name="cowrie,">
  <rule id="100010" level="3">
    <decoded_as>json</decoded_as>
    <field name="eventid">^cowrie\.</field>
    <description>Cowrie: Event logged</description>
  </rule>

  <rule id="100011" level="10">
    <if_sid>100010</if_sid>
    <field name="eventid">cowrie.session.connect</field>
    <description>Honeypot: Incoming connection from $(src_ip)</description>
    <group>mitre_t1098,</group>
  </rule>

  <rule id="100012" level="12">
    <if_sid>100010</if_sid>
    <field name="eventid">cowrie.login.success</field>
    <description>Honeypot: INTRUDER ALERT! Access granted to user: $(username)</description>
    <group>authentication_success,pci_dss_10.2.5,</group>
  </rule>

  <rule id="100013" level="7">
    <if_sid>100010</if_sid>
    <field name="eventid">cowrie.command.input</field>
    <description>Honeypot: Attacker executed command: $(input)</description>
  </rule>
</group>
```
5. Save and click "Restart Manager".

## ‚öîÔ∏è PHASE 6: Proof of Concept (Attack)
From your personal computer (Attacker):
```bash
ssh root@<HONEYPOT_PUBLIC_IP> -p 2222
```
1. Enter any password.
2. Execute commands like `whoami`, `ls`, `curl google.com`.
3. Verify in the Wazuh Dashboard (Security Events section) that red alerts appear.
